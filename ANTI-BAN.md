# Защита от бана Instagram

SecBrain использует несколько механизмов защиты от блокировок Instagram:

## 1. Rate Limiting (ограничение частоты запросов)

- **Минимальная задержка**: 3 секунды между запросами
- **Случайная задержка**: +0-2 секунды (рандомизация)
- **Задержка при 429**: автоматически 60+ секунд при rate limit

## 2. Retry с Exponential Backoff

При ошибках система автоматически повторяет запросы:
- **Попытка 1**: базовая задержка 5с
- **Попытка 2**: задержка 10с + random(0-5)
- **Попытка 3**: задержка 20с + random(0-5)
- **При rate limit (429)**: задержка умножается на 3 + random(10-30)

## 3. Cookies авторизации

Используйте актуальные cookies для обхода лимитов:

```bash
# Экспорт cookies из браузера (расширение Get cookies.txt LOCALLY)
# Сохраните как instagram_cookies.txt
```

## 4. User-Agent ротация

В `gallery-dl.conf` настроен реалистичный User-Agent:
```json
"user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
```

## 5. Таймауты и лимиты

- **Таймаут запроса**: 120 секунд
- **Макс попыток**: 3 для обычных ошибок
- **Скорость загрузки**: ограничена 1MB/s (безопасно)

## 6. Обнаружение блокировок

Система автоматически определяет:
- `429 Too Many Requests` → долгая задержка
- `login_required` → требуется обновить cookies
- `rate limit exceeded` → пауза на 1+ минуту

## Рекомендации

### Безопасное использование:
✅ Не более **10-15 постов подряд**
✅ Обновляйте cookies **раз в неделю**
✅ Используйте VPN или прокси для VPS
✅ Делайте перерывы между сессиями (30+ минут)

### Признаки бана:
⚠️ Постоянная ошибка `login_required`
⚠️ Все запросы возвращают 429
⚠️ gallery-dl требует капчу

### Что делать при бане:
1. Подождите **12-24 часа**
2. Обновите cookies с **другого устройства**
3. Используйте **прокси** (Residential IP лучше)
4. Уменьшите частоту запросов (`min_delay = 5.0` в коде)

## Настройка защиты

Файл: `gallery-dl.conf`
```json
{
    "extractor": {
        "instagram": {
            "sleep-request": "3.0-7.0",  // Задержка между запросами
            "sleep-429": "120",          // Задержка при rate limit
            "retries": 5                 // Количество попыток
        }
    }
}
```

Код: `src/modules/hybrid_grabber.py`
```python
self.min_delay = 3.0  # Измените на больше для большей безопасности
```

## Альтернативы при частом бане

Если Instagram постоянно блокирует:
1. Используйте **несколько аккаунтов** с разными cookies
2. Настройте **rotating proxy** в gallery-dl
3. Уменьшите частоту до **5-10 постов в день**
4. Рассмотрите платный API Instagram (официальный)
