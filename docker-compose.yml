services:
  secbrain:
    build: .
    container_name: secbrain_bot
    volumes:
      # --- ВАЖНО: Маппинг реальной структуры из structure.md ---
      
      # 1. Основное хранилище (Obsidian Vault пользователя)
      # Переменная USER_NAME берется из .env (по умолчанию 'lexey')
      - ./users/${USER_NAME:-lexey}:/app/data/vault
      
      # 2. Временные файлы (чтобы не мусорить в Vault)
      - ./temp:/app/data/temp
      
      # 3. Конфигурация бота (сессии, куки)
      - ./bot_state:/app/data/config
      
    environment:
      # Настройки путей внутри контейнера
      - DATA_DIR=/app/data
      - OUTPUT_DIR=/app/data/vault/downloads
      - TEMP_DIR=/app/data/temp
      
      # Настройки доступа
      - OLLAMA_HOST=${OLLAMA_HOST:-http://host.docker.internal:11434}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      
    extra_hosts:
      - "host.docker.internal:host-gateway"
      
    restart: unless-stopped