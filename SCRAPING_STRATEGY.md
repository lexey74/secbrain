# 🎯 Стратегия скрапинга SecBrain

## Архитектура загрузки контента

```
┌─────────────────────────────────────────────┐
│  Instagram Post URL                         │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────────────────────┐
│  📥 DOWNLOAD.PY                                          │
│  Вопрос: "💬 Скачивать комментарии через Playwright?"   │
│  ├─ YES → Playwright включается                         │
│  └─ NO  → Комментарии НЕ скачиваются                    │
└──────────────────────────────────────────────────────────┘
               │
        ┌──────┴──────┐
        ▼             ▼ (опционально)
┌───────────────┐  ┌──────────────────────┐
│  Gallery-dl   │  │  Playwright          │
│  ВСЕГДА       │  │  ЕСЛИ YES            │
└───────────────┘  └──────────────────────┘
        │                   │
        ▼                   ▼
┌─────────────────┐  ┌──────────────────┐
│ ✅ Видео        │  │ ✅ Комментарии   │
│ ✅ Картинки     │  │ (с лайками)      │
│ ✅ Описание     │  │                  │
│ ✅ Метаданные   │  │                  │
│ ❌ Комментарии  │  │                  │
└─────────────────┘  └──────────────────┘
```

## 📋 Таблица ответственности

| Тип данных | Gallery-dl | Playwright | Примечание |
|------------|-----------|-----------|-----------|
| **Видео** | ✅ Да | ❌ Нет | Всегда через gallery-dl |
| **Картинки** | ✅ Да | ❌ Нет | Все из карусели |
| **Описание** | ✅ Да | ❌ Нет | Caption поста |
| **Метаданные** | ✅ Да | ❌ Нет | Автор, дата, URL |
| **Транскрипция** | ✅ Да (Whisper) | ❌ Нет | Локально через Whisper |
| **Комментарии** | ❌ **НЕТ** | ✅ Да | **ТОЛЬКО через Playwright** |

## 🔑 Ключевые правила

### ❌ Gallery-dl НЕ скачивает комментарии
- Причина: Ненадёжно, легко детектируется
- Решение: Используйте Playwright

### ✅ Playwright - ЕДИНСТВЕННЫЙ способ получить комментарии
- Безопасно: Эмуляция настоящего браузера
- Надёжно: Перехват GraphQL запросов
- Гибко: Опциональное включение

### 🎭 Опциональность
- **YES** → Playwright запускается, комментарии скачиваются
- **NO** → Комментарии НЕ скачиваются вообще

## 📂 Структура результата

### Ответ YES (с комментариями):
```
SecondBrain_Inbox/
  └── 2026-01-10_author_title/
      ├── media.mp4          # Gallery-dl
      ├── media_2.jpg        # Gallery-dl
      ├── caption.md         # Gallery-dl
      ├── transcript.md      # Whisper
      └── comments.md        # Playwright ✨
```

### Ответ NO (без комментариев):
```
SecondBrain_Inbox/
  └── 2026-01-10_author_title/
      ├── media.mp4          # Gallery-dl
      ├── media_2.jpg        # Gallery-dl
      ├── caption.md         # Gallery-dl
      └── transcript.md      # Whisper
      # comments.md НЕ создаётся
```

## 🚀 Примеры использования

### Пример 1: Без комментариев (быстро)
```bash
$ python src/download.py

💬 Скачивать комментарии через Playwright? [y/n]: n
⚠️  Комментарии НЕ будут скачаны

Instagram URL: https://www.instagram.com/p/ABC123/

📥 Загрузка через gallery-dl...
   ✅ Загружено: 1 видео, 3 картинки
🎤 Транскрибация...
   ✅ Готово
💾 Сохранение...
   ✅ caption.md
   ✅ transcript.md

✅ Готово за 15 секунд
```

### Пример 2: С комментариями (безопасно)
```bash
$ python src/download.py

💬 Скачивать комментарии через Playwright? [y/n]: y
✅ Комментарии будут скачаны через Playwright (безопасно)

Instagram URL: https://www.instagram.com/p/ABC123/

📥 Загрузка через gallery-dl...
   ✅ Загружено: 1 видео, 3 картинки
🎤 Транскрибация...
   ✅ Готово
💾 Сохранение...
   ✅ caption.md
   ✅ transcript.md

🎭 Запуск браузера Playwright...
   🔗 Переход на пост
   🤖 Эмуляция (15 сек)
   💬 Найдено 42 комментария
   ✅ comments.md

✅ Готово за 45 секунд
```

## ⚡ Производительность

| Сценарий | Gallery-dl | Whisper | Playwright | Итого |
|----------|-----------|---------|-----------|-------|
| **Без комментариев** | 5-10 сек | 30-60 сек | - | **35-70 сек** |
| **С комментариями** | 5-10 сек | 30-60 сек | 25-30 сек | **60-100 сек** |

## 🔒 Безопасность

### Gallery-dl:
- ⚡ Быстро
- ⚠️ Средний риск бана (при частом использовании)
- ✅ Хорошо для медиа

### Playwright:
- 🐌 Медленнее
- ✅ Минимальный риск бана
- ✅ Единственный безопасный способ для комментариев

## 💡 Рекомендации

### Когда НЕ нужны комментарии:
- ✅ Просто сохраняете контент для себя
- ✅ Нужна максимальная скорость
- ✅ Обрабатываете много постов подряд

### Когда нужны комментарии:
- ✅ Анализ аудитории
- ✅ Сбор обратной связи
- ✅ Построение knowledge base
- ✅ Готовы подождать 30 секунд

## 🎓 Best Practices

1. **Для массовой загрузки (10+ постов):**
   ```bash
   # Шаг 1: Скачайте все БЕЗ комментариев (быстро)
   python src/download.py  # Ответ NO
   
   # Шаг 2: Выборочно добавьте комментарии к важным постам
   python src/download.py  # Ответ YES для избранных
   ```

2. **Для полной архивации:**
   ```bash
   # Всегда включайте Playwright (YES)
   # Делайте паузы между постами
   ```

3. **Для экспериментов:**
   ```bash
   # Начните без комментариев (NO)
   # Проверьте результат
   # Потом добавьте комментарии отдельно
   ```

---

**Создано:** 2026-01-10  
**Версия:** 2.0  
**Политика:** Gallery-dl для медиа, Playwright для комментариев
